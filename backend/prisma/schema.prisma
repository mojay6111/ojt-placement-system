generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  STUDENT
  INSTRUCTOR
  COORDINATOR
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  role         UserRole
  createdAt    DateTime @default(now())

  student               Student?
  instructor            Instructor?
  industrialCoordinator IndustrialCoordinator?
}

model Department {
  departmentID Int          @id @default(autoincrement())
  name         String
  code         String       @unique

  students    Student[]
  instructors Instructor[]
}

model Student {
  studentID       Int    @id @default(autoincrement())
  userID          Int    @unique
  user            User   @relation(fields: [userID], references: [id], onDelete: Cascade)

  admissionNumber String @unique
  firstName       String
  lastName        String

  departmentID  Int
  department    Department @relation(fields: [departmentID], references: [departmentID], onDelete: Restrict)

  ojtPlacements OJTPlacement[]
}

model Instructor {
  instructorID Int    @id @default(autoincrement())
  userID       Int    @unique
  user         User   @relation(fields: [userID], references: [id], onDelete: Cascade)

  firstName    String
  lastName     String

  departmentID Int
  department   Department @relation(fields: [departmentID], references: [departmentID], onDelete: Restrict)

  visits OJTVisit[]
}

model IndustrialCoordinator {
  coordinatorID Int    @id @default(autoincrement())
  userID        Int    @unique
  user          User   @relation(fields: [userID], references: [id], onDelete: Cascade)

  firstName  String
  lastName   String

  placements OJTPlacement[]
}

model OJTPlacement {
  placementID   Int @id @default(autoincrement())

  studentID     Int
  coordinatorID Int

  startDate DateTime
  endDate   DateTime

  student     Student @relation(fields: [studentID], references: [studentID], onDelete: Cascade)
  coordinator IndustrialCoordinator @relation(fields: [coordinatorID], references: [coordinatorID], onDelete: Restrict)

  instructorVisits OJTVisit[]
}

model OJTVisit {
  visitID Int @id @default(autoincrement())

  placementID  Int
  instructorID Int

  visitDate DateTime
  notes     String?

  placement  OJTPlacement @relation(fields: [placementID], references: [placementID], onDelete: Cascade)
  instructor Instructor   @relation(fields: [instructorID], references: [instructorID], onDelete: Restrict)
}
